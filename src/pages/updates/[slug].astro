---
import { getCollection, type CollectionEntry } from 'astro:content';
import { Icon } from 'astro-icon/components';
import Layout from '../../layouts/main-layout.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const updates = await getCollection('updates');
  return updates.map((update) => ({
    params: { slug: update.slug },
    props: { update },
  }));
}

interface Props {
  update: CollectionEntry<'updates'>;
}

const { update } = Astro.props;
const { Content } = await update.render();

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  }).format(date);
}
---

<Layout
  title={`${update.data.title} - Bière & Code Paris`}
  description={`Read the latest update: ${update.data.title}`}
>
  <!-- Navigation Header -->
  <header class="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur-md border-b border-[#fff0cb]/50 shadow-sm">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity duration-300">
        <img src="/logo.svg" alt="Bière Code Logo" width={44} height={44} />
        <span class="text-xl font-bold text-[#3f573e] font-grotesk hidden sm:block">Bière & Code</span>
      </a>
      <nav class="flex items-center gap-8">
        <a href="/about" class="text-sm font-medium text-[#3f573e] hover:text-[#cc6c11] transition-colors duration-300 relative group">
          About
          <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-[#cc6c11] transition-all duration-300 group-hover:w-full"></span>
        </a>
        <a href="/updates" class="text-sm font-medium text-[#cc6c11] transition-colors duration-300 relative">
          Updates
          <span class="absolute bottom-0 left-0 w-full h-0.5 bg-[#cc6c11]"></span>
        </a>
      </nav>
    </div>
  </header>

  <section class="min-h-screen bg-gradient-to-br from-[#fff0cb] via-[#f6f3ec] to-white pt-32 pb-20 px-6">
    <div class="max-w-3xl mx-auto space-y-8 md:space-y-10">
      <div class="flex justify-start">
        <a href="/updates" class="inline-flex items-center text-sm font-medium text-[#cc6c11] hover:text-[#e07d1c] transition-colors duration-300 group">
          <Icon name="lucide:arrow-left" class="w-4 h-4 mr-2 transform group-hover:-translate-x-1 transition-transform" />
          Back to Updates
        </a>
      </div>
      <article class="rounded-3xl bg-white shadow-[0_10px_30px_-10px_rgba(0,0,0,0.15)] border border-[#fff0cb]/30 overflow-hidden space-y-6 p-8 md:p-10">
        <div class="space-y-6">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div class="space-y-3">
              <span
                class={`inline-flex items-center px-3 py-1 text-xs font-semibold uppercase tracking-wide rounded-full ${
                  update.data.type === 'event' ? 'bg-[#1f7cec]/10 text-[#1f7cec]' : 'bg-[#fff0cb] text-[#cc6c11]'
                }`}
              >
                {update.data.type === 'event' ? 'Event' : 'Post'}
              </span>
              <h1 class="text-3xl md:text-4xl font-bold text-[#3f573e] leading-[1.4]">{update.data.title}</h1>
            </div>
            <div class="text-right text-xs text-[#6b7280] space-y-1">
              <p>Published {formatDate(update.data.published)}</p>
              {update.data.updated && update.data.updated.getTime() !== update.data.published.getTime() && (
                <p>Updated {formatDate(update.data.updated)}</p>
              )}
            </div>
          </div>
          <div class="text-base leading-relaxed text-[#6b7280] prose prose-sm max-w-none prose-headings:text-[#3f573e] prose-headings:font-bold prose-a:text-[#cc6c11] prose-a:no-underline hover:prose-a:underline">
            <Content />
          </div>
        </div>

        {update.data.type === 'event' && update.data.event && (
          <div class="bg-[#fff0cb]/30 border border-[#fff0cb] text-[#3f573e] text-sm rounded-2xl px-4 py-3 space-y-1">
            {(update.data.event.date || update.data.event.time) && (
              <p>
                <strong class="font-semibold">When:</strong> {[update.data.event.date, update.data.event.time].filter(Boolean).join(' • ')}
              </p>
            )}
            {update.data.event.location && (
              <p>
                <strong class="font-semibold">Where:</strong> {update.data.event.location}
              </p>
            )}
            {update.data.event.duration && (
              <p>
                <strong class="font-semibold">Duration:</strong> {update.data.event.duration}
              </p>
            )}
          </div>
        )}

        {update.data.tags && update.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-2">
            {update.data.tags.map((tag) => (
              <span class="text-xs uppercase tracking-wide bg-[#f6f3ec] text-[#6b7280] px-3 py-1 rounded-full">#{tag}</span>
            ))}
          </div>
        )}
      </article>
    </div>
  </section>
  <Footer/>
</Layout>
